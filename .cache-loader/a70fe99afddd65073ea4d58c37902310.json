{"remainingRequest":"/Users/jeffrey/HaulTesting/node_modules/thread-loader/dist/cjs.js??ref--5-1!/Users/jeffrey/HaulTesting/node_modules/babel-loader/lib/index.js??ref--5-2!/Users/jeffrey/HaulTesting/node_modules/react-native/Libraries/WebSocket/WebSocket.js","dependencies":[{"path":"/Users/jeffrey/HaulTesting/node_modules/react-native/Libraries/WebSocket/WebSocket.js","mtime":1539700108130},{"path":"/Users/jeffrey/HaulTesting/node_modules/cache-loader/dist/cjs.js","mtime":1539652983212},{"path":"/Users/jeffrey/HaulTesting/node_modules/thread-loader/dist/cjs.js","mtime":1539652983315},{"path":"/Users/jeffrey/HaulTesting/node_modules/babel-loader/lib/index.js","mtime":1539615827828}],"contextDependencies":[],"result":["'use strict';var _interopRequireDefault=require(\"@babel/runtime/helpers/interopRequireDefault\");var _objectWithoutProperties2=_interopRequireDefault(require(\"@babel/runtime/helpers/objectWithoutProperties\"));var _classCallCheck2=_interopRequireDefault(require(\"@babel/runtime/helpers/classCallCheck\"));var _createClass2=_interopRequireDefault(require(\"@babel/runtime/helpers/createClass\"));var _possibleConstructorReturn2=_interopRequireDefault(require(\"@babel/runtime/helpers/possibleConstructorReturn\"));var _getPrototypeOf2=_interopRequireDefault(require(\"@babel/runtime/helpers/getPrototypeOf\"));var _inherits2=_interopRequireDefault(require(\"@babel/runtime/helpers/inherits\"));(function(){var enterModule=require('react-hot-loader').enterModule;enterModule&&enterModule(module);})();var Blob=require('Blob');var EventTarget=require('event-target-shim');var NativeEventEmitter=require('NativeEventEmitter');var BlobManager=require('BlobManager');var NativeModules=require('NativeModules');var Platform=require('Platform');var WebSocketEvent=require('WebSocketEvent');var base64=require('base64-js');var binaryToBase64=require('binaryToBase64');var invariant=require('fbjs/lib/invariant');var WebSocketModule=NativeModules.WebSocketModule;var CONNECTING=0;var OPEN=1;var CLOSING=2;var CLOSED=3;var CLOSE_NORMAL=1000;var WEBSOCKET_EVENTS=['close','error','message','open'];var nextWebSocketId=0;var WebSocket=function(_EventTarget){(0,_inherits2.default)(WebSocket,_EventTarget);function WebSocket(url,protocols,options){var _this;(0,_classCallCheck2.default)(this,WebSocket);_this=(0,_possibleConstructorReturn2.default)(this,(0,_getPrototypeOf2.default)(WebSocket).call(this));_this.CONNECTING=CONNECTING;_this.OPEN=OPEN;_this.CLOSING=CLOSING;_this.CLOSED=CLOSED;_this.readyState=CONNECTING;if(typeof protocols==='string'){protocols=[protocols];}var _ref=options||{},_ref$headers=_ref.headers,headers=_ref$headers===void 0?{}:_ref$headers,unrecognized=(0,_objectWithoutProperties2.default)(_ref,[\"headers\"]);if(unrecognized&&typeof unrecognized.origin==='string'){console.warn('Specifying `origin` as a WebSocket connection option is deprecated. Include it under `headers` instead.');headers.origin=unrecognized.origin;delete unrecognized.origin;}if(Object.keys(unrecognized).length>0){console.warn('Unrecognized WebSocket connection option(s) `'+Object.keys(unrecognized).join('`, `')+'`. '+'Did you mean to put these under `headers`?');}if(!Array.isArray(protocols)){protocols=null;}if(!WebSocket.isAvailable){throw new Error('Cannot initialize WebSocket module. '+'Native module WebSocketModule is missing.');}_this._eventEmitter=new NativeEventEmitter(WebSocketModule);_this._socketId=nextWebSocketId++;_this._registerEvents();WebSocketModule.connect(url,protocols,{headers:headers},_this._socketId);return _this;}(0,_createClass2.default)(WebSocket,[{key:\"close\",value:function close(code,reason){if(this.readyState===this.CLOSING||this.readyState===this.CLOSED){return;}this.readyState=this.CLOSING;this._close(code,reason);}},{key:\"send\",value:function send(data){if(this.readyState===this.CONNECTING){throw new Error('INVALID_STATE_ERR');}if(data instanceof Blob){invariant(BlobManager.isAvailable,'Native module BlobModule is required for blob support');BlobManager.sendOverSocket(data,this._socketId);return;}if(typeof data==='string'){WebSocketModule.send(data,this._socketId);return;}if(data instanceof ArrayBuffer||ArrayBuffer.isView(data)){WebSocketModule.sendBinary(binaryToBase64(data),this._socketId);return;}throw new Error('Unsupported data type');}},{key:\"ping\",value:function ping(){if(this.readyState===this.CONNECTING){throw new Error('INVALID_STATE_ERR');}WebSocketModule.ping(this._socketId);}},{key:\"_close\",value:function _close(code,reason){if(Platform.OS==='android'){var statusCode=typeof code==='number'?code:CLOSE_NORMAL;var closeReason=typeof reason==='string'?reason:'';WebSocketModule.close(statusCode,closeReason,this._socketId);}else{WebSocketModule.close(this._socketId);}if(BlobManager.isAvailable&&this._binaryType==='blob'){BlobManager.removeWebSocketHandler(this._socketId);}}},{key:\"_unregisterEvents\",value:function _unregisterEvents(){this._subscriptions.forEach(function(e){return e.remove();});this._subscriptions=[];}},{key:\"_registerEvents\",value:function _registerEvents(){var _this2=this;this._subscriptions=[this._eventEmitter.addListener('websocketMessage',function(ev){if(ev.id!==_this2._socketId){return;}var data=ev.data;switch(ev.type){case'binary':data=base64.toByteArray(ev.data).buffer;break;case'blob':data=BlobManager.createFromOptions(ev.data);break;}_this2.dispatchEvent(new WebSocketEvent('message',{data:data}));}),this._eventEmitter.addListener('websocketOpen',function(ev){if(ev.id!==_this2._socketId){return;}_this2.readyState=_this2.OPEN;_this2.dispatchEvent(new WebSocketEvent('open'));}),this._eventEmitter.addListener('websocketClosed',function(ev){if(ev.id!==_this2._socketId){return;}_this2.readyState=_this2.CLOSED;_this2.dispatchEvent(new WebSocketEvent('close',{code:ev.code,reason:ev.reason}));_this2._unregisterEvents();_this2.close();}),this._eventEmitter.addListener('websocketFailed',function(ev){if(ev.id!==_this2._socketId){return;}_this2.readyState=_this2.CLOSED;_this2.dispatchEvent(new WebSocketEvent('error',{message:ev.message}));_this2.dispatchEvent(new WebSocketEvent('close',{message:ev.message}));_this2._unregisterEvents();_this2.close();})];}},{key:\"__reactstandin__regenerateByEval\",value:function __reactstandin__regenerateByEval(key,code){this[key]=eval(code);}},{key:\"binaryType\",get:function get(){return this._binaryType;},set:function set(binaryType){if(binaryType!=='blob'&&binaryType!=='arraybuffer'){throw new Error(\"binaryType must be either 'blob' or 'arraybuffer'\");}if(this._binaryType==='blob'||binaryType==='blob'){invariant(BlobManager.isAvailable,'Native module BlobModule is required for blob support');if(binaryType==='blob'){BlobManager.addWebSocketHandler(this._socketId);}else{BlobManager.removeWebSocketHandler(this._socketId);}}this._binaryType=binaryType;}}]);return WebSocket;}(EventTarget.apply(void 0,WEBSOCKET_EVENTS));WebSocket.CONNECTING=CONNECTING;WebSocket.OPEN=OPEN;WebSocket.CLOSING=CLOSING;WebSocket.CLOSED=CLOSED;WebSocket.isAvailable=!!WebSocketModule;module.exports=WebSocket;;(function(){var reactHotLoader=require('react-hot-loader').default;var leaveModule=require('react-hot-loader').leaveModule;if(!reactHotLoader){return;}reactHotLoader.register(WebSocketModule,\"WebSocketModule\",\"/Users/jeffrey/HaulTesting/node_modules/react-native/Libraries/WebSocket/WebSocket.js\");reactHotLoader.register(CONNECTING,\"CONNECTING\",\"/Users/jeffrey/HaulTesting/node_modules/react-native/Libraries/WebSocket/WebSocket.js\");reactHotLoader.register(OPEN,\"OPEN\",\"/Users/jeffrey/HaulTesting/node_modules/react-native/Libraries/WebSocket/WebSocket.js\");reactHotLoader.register(CLOSING,\"CLOSING\",\"/Users/jeffrey/HaulTesting/node_modules/react-native/Libraries/WebSocket/WebSocket.js\");reactHotLoader.register(CLOSED,\"CLOSED\",\"/Users/jeffrey/HaulTesting/node_modules/react-native/Libraries/WebSocket/WebSocket.js\");reactHotLoader.register(CLOSE_NORMAL,\"CLOSE_NORMAL\",\"/Users/jeffrey/HaulTesting/node_modules/react-native/Libraries/WebSocket/WebSocket.js\");reactHotLoader.register(WEBSOCKET_EVENTS,\"WEBSOCKET_EVENTS\",\"/Users/jeffrey/HaulTesting/node_modules/react-native/Libraries/WebSocket/WebSocket.js\");reactHotLoader.register(nextWebSocketId,\"nextWebSocketId\",\"/Users/jeffrey/HaulTesting/node_modules/react-native/Libraries/WebSocket/WebSocket.js\");reactHotLoader.register(WebSocket,\"WebSocket\",\"/Users/jeffrey/HaulTesting/node_modules/react-native/Libraries/WebSocket/WebSocket.js\");leaveModule(module);})();;",{"version":3,"sources":["/Users/jeffrey/HaulTesting/node_modules/react-native/Libraries/WebSocket/WebSocket.js"],"names":["Blob","require","EventTarget","NativeEventEmitter","BlobManager","NativeModules","Platform","WebSocketEvent","base64","binaryToBase64","invariant","WebSocketModule","CONNECTING","OPEN","CLOSING","CLOSED","CLOSE_NORMAL","WEBSOCKET_EVENTS","nextWebSocketId","WebSocket","url","protocols","options","readyState","headers","unrecognized","origin","console","warn","Object","keys","length","join","Array","isArray","isAvailable","Error","_eventEmitter","_socketId","_registerEvents","connect","code","reason","_close","data","sendOverSocket","send","ArrayBuffer","isView","sendBinary","ping","OS","statusCode","closeReason","close","_binaryType","removeWebSocketHandler","_subscriptions","forEach","e","remove","addListener","ev","id","type","toByteArray","buffer","createFromOptions","dispatchEvent","_unregisterEvents","message","binaryType","addWebSocketHandler","module","exports"],"mappings":"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","sourcesContent":["/**\n * Copyright (c) 2015-present, Facebook, Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @format\n * @flow\n */\n\n'use strict';\n\nconst Blob = require('Blob');\nconst EventTarget = require('event-target-shim');\nconst NativeEventEmitter = require('NativeEventEmitter');\nconst BlobManager = require('BlobManager');\nconst NativeModules = require('NativeModules');\nconst Platform = require('Platform');\nconst WebSocketEvent = require('WebSocketEvent');\n\n/* $FlowFixMe(>=0.54.0 site=react_native_oss) This comment suppresses an error\n * found when Flow v0.54 was deployed. To see the error delete this comment and\n * run Flow. */\nconst base64 = require('base64-js');\nconst binaryToBase64 = require('binaryToBase64');\nconst invariant = require('fbjs/lib/invariant');\n\nconst {WebSocketModule} = NativeModules;\n\nimport type EventSubscription from 'EventSubscription';\n\ntype ArrayBufferView =\n  | Int8Array\n  | Uint8Array\n  | Uint8ClampedArray\n  | Int16Array\n  | Uint16Array\n  | Int32Array\n  | Uint32Array\n  | Float32Array\n  | Float64Array\n  | DataView;\n\ntype BinaryType = 'blob' | 'arraybuffer';\n\nconst CONNECTING = 0;\nconst OPEN = 1;\nconst CLOSING = 2;\nconst CLOSED = 3;\n\nconst CLOSE_NORMAL = 1000;\n\nconst WEBSOCKET_EVENTS = ['close', 'error', 'message', 'open'];\n\nlet nextWebSocketId = 0;\n\n/**\n * Browser-compatible WebSockets implementation.\n *\n * See https://developer.mozilla.org/en-US/docs/Web/API/WebSocket\n * See https://github.com/websockets/ws\n */\nclass WebSocket extends EventTarget(...WEBSOCKET_EVENTS) {\n  static CONNECTING = CONNECTING;\n  static OPEN = OPEN;\n  static CLOSING = CLOSING;\n  static CLOSED = CLOSED;\n\n  CONNECTING: number = CONNECTING;\n  OPEN: number = OPEN;\n  CLOSING: number = CLOSING;\n  CLOSED: number = CLOSED;\n\n  _socketId: number;\n  _eventEmitter: NativeEventEmitter;\n  _subscriptions: Array<EventSubscription>;\n  _binaryType: ?BinaryType;\n\n  onclose: ?Function;\n  onerror: ?Function;\n  onmessage: ?Function;\n  onopen: ?Function;\n\n  bufferedAmount: number;\n  extension: ?string;\n  protocol: ?string;\n  readyState: number = CONNECTING;\n  url: ?string;\n\n  // This module depends on the native `WebSocketModule` module. If you don't include it,\n  // `WebSocket.isAvailable` will return `false`, and WebSocket constructor will throw an error\n  static isAvailable: boolean = !!WebSocketModule;\n\n  constructor(\n    url: string,\n    protocols: ?string | ?Array<string>,\n    options: ?{headers?: {origin?: string}},\n  ) {\n    super();\n    if (typeof protocols === 'string') {\n      protocols = [protocols];\n    }\n\n    const {headers = {}, ...unrecognized} = options || {};\n\n    // Preserve deprecated backwards compatibility for the 'origin' option\n    /* $FlowFixMe(>=0.68.0 site=react_native_fb) This comment suppresses an\n     * error found when Flow v0.68 was deployed. To see the error delete this\n     * comment and run Flow. */\n    if (unrecognized && typeof unrecognized.origin === 'string') {\n      console.warn(\n        'Specifying `origin` as a WebSocket connection option is deprecated. Include it under `headers` instead.',\n      );\n      /* $FlowFixMe(>=0.54.0 site=react_native_fb,react_native_oss) This\n       * comment suppresses an error found when Flow v0.54 was deployed. To see\n       * the error delete this comment and run Flow. */\n      headers.origin = unrecognized.origin;\n      /* $FlowFixMe(>=0.54.0 site=react_native_fb,react_native_oss) This\n       * comment suppresses an error found when Flow v0.54 was deployed. To see\n       * the error delete this comment and run Flow. */\n      delete unrecognized.origin;\n    }\n\n    // Warn about and discard anything else\n    if (Object.keys(unrecognized).length > 0) {\n      console.warn(\n        'Unrecognized WebSocket connection option(s) `' +\n          Object.keys(unrecognized).join('`, `') +\n          '`. ' +\n          'Did you mean to put these under `headers`?',\n      );\n    }\n\n    if (!Array.isArray(protocols)) {\n      protocols = null;\n    }\n\n    if (!WebSocket.isAvailable) {\n      throw new Error(\n        'Cannot initialize WebSocket module. ' +\n          'Native module WebSocketModule is missing.',\n      );\n    }\n\n    this._eventEmitter = new NativeEventEmitter(WebSocketModule);\n    this._socketId = nextWebSocketId++;\n    this._registerEvents();\n    WebSocketModule.connect(\n      url,\n      protocols,\n      {headers},\n      this._socketId,\n    );\n  }\n\n  get binaryType(): ?BinaryType {\n    return this._binaryType;\n  }\n\n  set binaryType(binaryType: BinaryType): void {\n    if (binaryType !== 'blob' && binaryType !== 'arraybuffer') {\n      throw new Error(\"binaryType must be either 'blob' or 'arraybuffer'\");\n    }\n    if (this._binaryType === 'blob' || binaryType === 'blob') {\n      invariant(\n        BlobManager.isAvailable,\n        'Native module BlobModule is required for blob support',\n      );\n      if (binaryType === 'blob') {\n        BlobManager.addWebSocketHandler(this._socketId);\n      } else {\n        BlobManager.removeWebSocketHandler(this._socketId);\n      }\n    }\n    this._binaryType = binaryType;\n  }\n\n  get binaryType(): ?BinaryType {\n    return this._binaryType;\n  }\n\n  close(code?: number, reason?: string): void {\n    if (this.readyState === this.CLOSING || this.readyState === this.CLOSED) {\n      return;\n    }\n\n    this.readyState = this.CLOSING;\n    this._close(code, reason);\n  }\n\n  send(data: string | ArrayBuffer | ArrayBufferView | Blob): void {\n    if (this.readyState === this.CONNECTING) {\n      throw new Error('INVALID_STATE_ERR');\n    }\n\n    if (data instanceof Blob) {\n      invariant(\n        BlobManager.isAvailable,\n        'Native module BlobModule is required for blob support',\n      );\n      BlobManager.sendOverSocket(data, this._socketId);\n      return;\n    }\n\n    if (typeof data === 'string') {\n      WebSocketModule.send(data, this._socketId);\n      return;\n    }\n\n    if (data instanceof ArrayBuffer || ArrayBuffer.isView(data)) {\n      WebSocketModule.sendBinary(binaryToBase64(data), this._socketId);\n      return;\n    }\n\n    throw new Error('Unsupported data type');\n  }\n\n  ping(): void {\n    if (this.readyState === this.CONNECTING) {\n      throw new Error('INVALID_STATE_ERR');\n    }\n\n    WebSocketModule.ping(this._socketId);\n  }\n\n  _close(code?: number, reason?: string): void {\n    if (Platform.OS === 'android') {\n      // See https://developer.mozilla.org/en-US/docs/Web/API/CloseEvent\n      const statusCode = typeof code === 'number' ? code : CLOSE_NORMAL;\n      const closeReason = typeof reason === 'string' ? reason : '';\n      WebSocketModule.close(statusCode, closeReason, this._socketId);\n    } else {\n      WebSocketModule.close(this._socketId);\n    }\n\n    if (BlobManager.isAvailable && this._binaryType === 'blob') {\n      BlobManager.removeWebSocketHandler(this._socketId);\n    }\n  }\n\n  _unregisterEvents(): void {\n    this._subscriptions.forEach(e => e.remove());\n    this._subscriptions = [];\n  }\n\n  _registerEvents(): void {\n    this._subscriptions = [\n      this._eventEmitter.addListener('websocketMessage', ev => {\n        if (ev.id !== this._socketId) {\n          return;\n        }\n        let data = ev.data;\n        switch (ev.type) {\n          case 'binary':\n            data = base64.toByteArray(ev.data).buffer;\n            break;\n          case 'blob':\n            data = BlobManager.createFromOptions(ev.data);\n            break;\n        }\n        this.dispatchEvent(new WebSocketEvent('message', {data}));\n      }),\n      this._eventEmitter.addListener('websocketOpen', ev => {\n        if (ev.id !== this._socketId) {\n          return;\n        }\n        this.readyState = this.OPEN;\n        this.dispatchEvent(new WebSocketEvent('open'));\n      }),\n      this._eventEmitter.addListener('websocketClosed', ev => {\n        if (ev.id !== this._socketId) {\n          return;\n        }\n        this.readyState = this.CLOSED;\n        this.dispatchEvent(\n          new WebSocketEvent('close', {\n            code: ev.code,\n            reason: ev.reason,\n          }),\n        );\n        this._unregisterEvents();\n        this.close();\n      }),\n      this._eventEmitter.addListener('websocketFailed', ev => {\n        if (ev.id !== this._socketId) {\n          return;\n        }\n        this.readyState = this.CLOSED;\n        this.dispatchEvent(\n          new WebSocketEvent('error', {\n            message: ev.message,\n          }),\n        );\n        this.dispatchEvent(\n          new WebSocketEvent('close', {\n            message: ev.message,\n          }),\n        );\n        this._unregisterEvents();\n        this.close();\n      }),\n    ];\n  }\n}\n\nmodule.exports = WebSocket;\n"]}]}